<!DOCTYPE html>
<html$if(lang)$ lang="$lang$"$else$ lang="en"$endif$>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>$if(title-prefix)$$title-prefix$ - $endif$$if(title)$$title$$else$$pagetitle$$endif$</title>
  <style>
    :root {
      --vc-bg: #f2ecde;
      --vc-surface: #fffaf0;
      --vc-surface-strong: #fff5e4;
      --vc-ink: #1f1a16;
      --vc-muted: #5e5146;
      --vc-accent: #b0532f;
      --vc-accent-soft: #e7c5a3;
      --vc-border: #ddcbb8;
      --vc-shadow: 0 18px 42px rgba(50, 34, 24, 0.14);
      --vc-radius: 18px;
      --vc-gap: clamp(12px, 1.8vw, 24px);
      --vc-header-height: 64px;
      --vc-layout-max: 1520px;
      --vc-text: clamp(0.98rem, 0.93rem + 0.18vw, 1.06rem);
      --vc-title: clamp(1.38rem, 1.03rem + 1.35vw, 2.2rem);
      --vc-card-title: clamp(1.2rem, 1.03rem + 0.66vw, 1.56rem);
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      max-width: 100%;
      overflow-x: clip;
    }

    body {
      font-family: "Iowan Old Style", "Palatino Linotype", Palatino, "Book Antiqua", serif;
      font-size: var(--vc-text);
      line-height: 1.6;
      color: var(--vc-ink);
      background:
        radial-gradient(circle at 8% 12%, rgba(244, 219, 183, 0.65), transparent 42%),
        radial-gradient(circle at 92% 6%, rgba(225, 201, 169, 0.58), transparent 35%),
        linear-gradient(180deg, #f8f2e8 0%, var(--vc-bg) 100%);
    }

    a {
      color: var(--vc-accent);
      text-decoration-thickness: 1.2px;
      text-underline-offset: 2px;
    }

    .vc-topbar {
      position: sticky;
      top: 0;
      z-index: 80;
      border-bottom: 1px solid var(--vc-border);
      background: rgba(255, 248, 236, 0.95);
      backdrop-filter: blur(8px);
    }

    .vc-topbar-inner {
      margin: 0 auto;
      max-width: var(--vc-layout-max);
      padding: 8px var(--vc-gap);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .vc-brand {
      min-width: 0;
    }

    .vc-kicker {
      margin: 0;
      color: var(--vc-muted);
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.075em;
    }

    .vc-brand h1 {
      margin: 1px 0 0;
      font-size: var(--vc-title);
      line-height: 1.08;
      letter-spacing: 0.015em;
    }

    .vc-subtitle,
    .vc-author {
      margin: 2px 0 0;
      color: var(--vc-muted);
      line-height: 1.3;
      font-size: 0.92rem;
    }

    #vc-nav-toggle {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-height: 44px;
      min-width: 44px;
      border-radius: 999px;
      border: 1px solid var(--vc-border);
      background: var(--vc-surface-strong);
      color: var(--vc-ink);
      padding: 0 14px;
      font-size: 0.94rem;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
    }

    .vc-layout {
      max-width: var(--vc-layout-max);
      margin: 0 auto;
      padding: var(--vc-gap);
      position: relative;
    }

    .vc-rail {
      position: relative;
    }

    .vc-nav-panel {
      display: none;
      background: var(--vc-surface);
      border: 1px solid var(--vc-border);
      border-radius: var(--vc-radius);
      box-shadow: var(--vc-shadow);
      padding: 10px;
    }

    body.nav-open .vc-nav-panel {
      display: block;
      position: fixed;
      top: calc(var(--vc-header-height) + 8px);
      left: 10px;
      right: 10px;
      max-height: calc(100dvh - (var(--vc-header-height) + 20px));
      overflow: auto;
      z-index: 90;
    }

    body.nav-open::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(22, 16, 12, 0.34);
      z-index: 85;
    }

    .vc-nav-title {
      margin: 0 0 8px;
      font-size: 0.96rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--vc-muted);
    }

    .vc-music-panel {
      background: var(--vc-surface);
      border: 1px solid var(--vc-border);
      border-radius: var(--vc-radius);
      box-shadow: var(--vc-shadow);
      padding: 10px;
    }

    .vc-music-panel-desktop {
      display: none;
    }

    .vc-music-panel-mobile {
      margin: 0 0 var(--vc-gap);
    }

    .vc-music-title {
      margin: 0;
      font-size: 0.96rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--vc-muted);
    }

    .vc-music-meta {
      margin-top: 8px;
      color: var(--vc-ink);
    }

    .vc-music-meta p {
      margin: 0.2em 0;
      line-height: 1.4;
    }

    .vc-music-links {
      margin: 8px 0 0;
    }

    .vc-music-link {
      display: inline-flex;
      align-items: center;
      min-height: 44px;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid var(--vc-border);
      background: var(--vc-surface-strong);
      text-decoration: none;
      font-weight: 600;
    }

    .vc-music-link::before {
      content: "â–¶";
      margin-right: 0.45em;
      font-size: 0.84em;
      line-height: 1;
    }

    #vc-nav-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 6px;
    }

    .vc-nav-item-recipe {
      margin-left: 10px;
    }

    .vc-nav-link {
      display: flex;
      align-items: center;
      min-height: 44px;
      border-radius: 10px;
      padding: 8px 10px;
      text-decoration: none;
      color: var(--vc-ink);
      border: 1px solid transparent;
    }

    .vc-nav-link:hover,
    .vc-nav-link:focus-visible {
      border-color: var(--vc-accent-soft);
      background: #f9efdf;
      outline: none;
    }

    .vc-nav-link[aria-current="true"] {
      border-color: var(--vc-accent-soft);
      background: #f5e5cf;
      color: #2b1f15;
      font-weight: 700;
    }

    .vc-content {
      min-width: 0;
    }

    h1.vc-chapter-title {
      margin: 0.4em 0 0.25em;
      font-size: clamp(1.25rem, 1.04rem + 0.85vw, 1.85rem);
      color: var(--vc-muted);
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .vc-recipe-card {
      margin: 0 0 var(--vc-gap);
      background: var(--vc-surface);
      border: 1px solid var(--vc-border);
      border-radius: var(--vc-radius);
      box-shadow: var(--vc-shadow);
      padding: clamp(12px, 1.8vw, 22px);
    }

    .vc-recipe-shell {
      display: grid;
      gap: clamp(12px, 1.7vw, 24px);
      align-items: start;
    }

    .vc-recipe-col {
      min-width: 0;
    }

    h2.vc-recipe-title {
      margin: 0 0 4px;
      font-size: var(--vc-card-title);
      line-height: 1.1;
      letter-spacing: 0.01em;
    }

    h2.vc-ingredients-heading,
    h2.vc-method-heading,
    h2.vc-notes-heading {
      margin: 0.85em 0 0.25em;
      font-size: clamp(1.03rem, 0.96rem + 0.28vw, 1.16rem);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--vc-muted);
    }

    h3.vc-subsection-heading {
      margin: 0.72em 0 0.16em;
      font-size: 0.98rem;
      letter-spacing: 0.025em;
      color: var(--vc-ink);
    }

    .vc-recipe-intro {
      color: var(--vc-muted);
      line-height: 1.5;
    }

    .vc-section p {
      margin: 0.35em 0 0.5em;
    }

    .vc-section + .vc-section {
      margin-top: 12px;
    }

    .vc-hero {
      margin: 10px 0 12px;
      max-width: 100%;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--vc-border);
      background: linear-gradient(90deg, #f8f0e5 0%, #f5ebdb 55%, #efe1cb 100%);
      padding: clamp(8px, 1.2vw, 12px);
      display: grid;
      place-items: center;
    }

    .vc-hero img {
      display: block;
      width: min(100%, 440px);
      height: auto;
      max-height: clamp(150px, 28dvh, 280px);
      object-fit: contain;
      object-position: center;
    }

    .vc-recipe-card ul,
    .vc-recipe-card ol {
      margin: 0.28em 0 0.48em;
      padding-inline-start: 1.14em;
    }

    .vc-recipe-card li {
      margin-bottom: 0.2em;
    }

    img,
    table,
    pre,
    code {
      max-width: 100%;
    }

    table {
      display: block;
      overflow-x: auto;
      border-collapse: collapse;
    }

    @media (min-width: 960px) {
      #vc-nav-toggle {
        display: none;
      }

      .vc-layout {
        display: grid;
        grid-template-columns: minmax(210px, 250px) minmax(0, 1fr);
        align-items: start;
        gap: var(--vc-gap);
      }

      .vc-rail {
        display: grid;
        gap: var(--vc-gap);
        position: sticky;
        top: calc(var(--vc-header-height) + var(--vc-gap));
        max-height: calc(100dvh - (var(--vc-header-height) + var(--vc-gap) * 2));
        align-content: start;
      }

      .vc-music-panel-desktop {
        display: block;
      }

      .vc-music-panel-mobile {
        display: none;
      }

      .vc-recipe-shell {
        grid-template-columns: minmax(300px, 0.94fr) minmax(320px, 1.06fr);
      }

      .vc-col-left {
        padding-right: clamp(6px, 1vw, 12px);
        border-right: 1px solid var(--vc-border);
      }

      .vc-col-right {
        padding-left: clamp(6px, 1vw, 12px);
      }

      .vc-nav-panel {
        display: block;
        position: relative;
        top: auto;
        max-height: min(56dvh, 640px);
        overflow: auto;
      }

      body.nav-open::before {
        display: none;
      }

      body.nav-open .vc-nav-panel {
        position: relative;
        top: auto;
        left: auto;
        right: auto;
        max-height: min(56dvh, 640px);
        z-index: auto;
      }
    }

    @media (max-width: 959px) {
      .vc-recipe-shell {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 448px) {
      .vc-topbar-inner {
        align-items: flex-start;
      }

      #vc-nav-toggle {
        padding-inline: 12px;
      }

      .vc-nav-item-recipe {
        margin-left: 2px;
      }
    }
  </style>
</head>
<body>
  <header class="vc-topbar">
    <div class="vc-topbar-inner">
      <div class="vc-brand">
        <p class="vc-kicker">vaultchef web view</p>
        <h1>$if(title)$$title$$else$$pagetitle$$endif$</h1>
$if(subtitle)$
        <p class="vc-subtitle">$subtitle$</p>
$endif$
$if(author)$
        <p class="vc-author">By $author$</p>
$endif$
      </div>
      <button id="vc-nav-toggle" type="button" aria-expanded="false" aria-controls="vc-nav-list">Contents</button>
    </div>
  </header>

  <div class="vc-layout">
    <aside class="vc-rail" aria-label="Cookbook navigation rail">
      <section class="vc-nav-panel" id="vc-nav-panel">
        <h2 class="vc-nav-title">Contents</h2>
        <nav aria-label="Cookbook sections">
          <ol id="vc-nav-list"></ol>
        </nav>
      </section>
$if(has_music_pairing)$
      <section class="vc-music-panel vc-music-panel-desktop" aria-label="Music pairing">
        <h2 class="vc-music-title">Music Pairing</h2>
        <div class="vc-music-meta">
$if(album_title)$
          <p><strong>Album:</strong> $album_title$</p>
$endif$
$if(album_artist)$
          <p><strong>Artist:</strong> $album_artist$</p>
$endif$
$if(album_style)$
          <p><strong>Style:</strong> $album_style$</p>
$endif$
$if(album_youtube_url)$
          <p class="vc-music-links">
            <a class="vc-music-link" data-vc-music-url="$album_youtube_url$" href="$album_youtube_url$" target="_blank" rel="noopener noreferrer">Play on YouTube Music</a>
          </p>
$endif$
        </div>
      </section>
$endif$
    </aside>

    <main class="vc-content" id="vc-content">
$if(has_music_pairing)$
      <section class="vc-music-panel vc-music-panel-mobile" aria-label="Music pairing">
        <h2 class="vc-music-title">Music Pairing</h2>
        <div class="vc-music-meta">
$if(album_title)$
          <p><strong>Album:</strong> $album_title$</p>
$endif$
$if(album_artist)$
          <p><strong>Artist:</strong> $album_artist$</p>
$endif$
$if(album_style)$
          <p><strong>Style:</strong> $album_style$</p>
$endif$
$if(album_youtube_url)$
          <p class="vc-music-links">
            <a class="vc-music-link" data-vc-music-url="$album_youtube_url$" href="$album_youtube_url$" target="_blank" rel="noopener noreferrer">Play on YouTube Music</a>
          </p>
$endif$
        </div>
      </section>
$endif$
$body$
    </main>
  </div>

  <script>
    (() => {
      const navList = document.getElementById("vc-nav-list");
      const navToggle = document.getElementById("vc-nav-toggle");
      const topbar = document.querySelector(".vc-topbar");
      const headings = Array.from(document.querySelectorAll(".vc-chapter-title, .vc-recipe-title"));
      const links = [];

      const toYouTubeMusicUrl = (raw) => {
        if (!raw) {
          return null;
        }

        let url;
        try {
          url = new URL(raw, window.location.href);
        } catch (_) {
          return null;
        }

        const host = url.hostname.replace(/^www\./, "").toLowerCase();
        const isYouTubeHost =
          host === "youtube.com" || host === "m.youtube.com" || host === "music.youtube.com" || host === "youtu.be";
        if (!isYouTubeHost) {
          return null;
        }

        const parts = url.pathname.split("/").filter(Boolean);
        let videoId = "";
        let listId = url.searchParams.get("list") || "";

        if (host === "youtu.be") {
          videoId = parts[0] || "";
        } else if (parts[0] === "watch") {
          videoId = url.searchParams.get("v") || "";
        } else if (parts[0] === "shorts" || parts[0] === "live" || parts[0] === "embed") {
          videoId = parts[1] || "";
        } else if (parts[0] === "playlist") {
          listId = url.searchParams.get("list") || "";
        }

        if (videoId) {
          const params = new URLSearchParams({ v: videoId });
          if (listId) {
            params.set("list", listId);
          }
          return "https://music.youtube.com/watch?" + params.toString();
        }

        if (listId) {
          return "https://music.youtube.com/playlist?list=" + encodeURIComponent(listId);
        }

        return null;
      };

      const hydrateMusicLinks = () => {
        const links = Array.from(document.querySelectorAll(".vc-music-link[data-vc-music-url]"));
        links.forEach((link) => {
          const raw = link.dataset.vcMusicUrl || "";
          const musicUrl = toYouTubeMusicUrl(raw);
          if (musicUrl) {
            link.href = musicUrl;
          }
        });
      };

      hydrateMusicLinks();

      if (!navList || !navToggle || headings.length === 0) {
        if (navToggle) {
          navToggle.hidden = true;
        }
        return;
      }

      headings.forEach((heading, idx) => {
        if (!heading.id) {
          heading.id = "section-" + (idx + 1);
        }

        const isRecipe = heading.classList.contains("vc-recipe-title");
        const item = document.createElement("li");
        item.className = isRecipe ? "vc-nav-item-recipe" : "vc-nav-item-chapter";

        const link = document.createElement("a");
        link.className = "vc-nav-link";
        link.href = "#" + heading.id;
        link.textContent = heading.textContent.trim();
        link.dataset.target = heading.id;

        item.appendChild(link);
        navList.appendChild(item);
        links.push(link);
      });

      const byId = new Map(links.map((link) => [link.dataset.target, link]));

      const setCurrentLink = (targetLink) => {
        if (!targetLink) {
          return;
        }
        links.forEach((candidate) => candidate.removeAttribute("aria-current"));
        targetLink.setAttribute("aria-current", "true");
      };

      const setFirstLinkAtTop = () => {
        if (window.scrollY <= 6 && links.length > 0) {
          setCurrentLink(links[0]);
        }
      };

      const setExpanded = (expanded) => {
        navToggle.setAttribute("aria-expanded", expanded ? "true" : "false");
        document.body.classList.toggle("nav-open", expanded);
      };

      const syncHeaderHeight = () => {
        if (!topbar) {
          return;
        }
        const height = Math.ceil(topbar.getBoundingClientRect().height);
        if (height > 0) {
          document.documentElement.style.setProperty("--vc-header-height", height + "px");
        }
      };

      navToggle.addEventListener("click", () => {
        const expanded = navToggle.getAttribute("aria-expanded") === "true";
        setExpanded(!expanded);
      });

      links.forEach((link) => {
        link.addEventListener("click", () => {
          if (window.matchMedia("(max-width: 959px)").matches) {
            setExpanded(false);
          }
        });
      });

      document.addEventListener("keydown", (event) => {
        if (event.key === "Escape") {
          setExpanded(false);
        }
      });

      window.addEventListener("scroll", setFirstLinkAtTop, { passive: true });

      if ("IntersectionObserver" in window) {
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              const link = byId.get(entry.target.id);
              if (!link) {
                return;
              }
              if (entry.isIntersecting) {
                setCurrentLink(link);
              }
            });
          },
          {
            rootMargin: "-30% 0px -60% 0px",
            threshold: [0, 1],
          }
        );

        headings.forEach((heading) => observer.observe(heading));
      }

      const syncDesktopState = () => {
        syncHeaderHeight();
        if (window.matchMedia("(min-width: 960px)").matches) {
          setExpanded(false);
        }
        setFirstLinkAtTop();
      };

      window.addEventListener("resize", syncDesktopState);
      window.addEventListener("load", syncDesktopState);
      syncDesktopState();
      requestAnimationFrame(syncHeaderHeight);
      setFirstLinkAtTop();
    })();
  </script>
</body>
</html>
